% made by: KorG
% vim: ft=tex et :
\documentclass[oneside]{book}

\usepackage[T1,T2A]{fontenc}       % fonts
\usepackage[utf8]{inputenc}     % UTF-8
\usepackage[english,russian]{babel}     % russian
\usepackage{cmap}               % russian search in pdf
\usepackage{pscyr}		        % PSCyr
\usepackage[14pt]{extsizes}     % for compatibility
\usepackage{float}		        % essential for [H]

\usepackage{indentfirst}        % first string indention

\usepackage{graphicx}           % graphics
\usepackage{ltxtable}           % tables

\usepackage{amsmath}            % math
\usepackage{nccmath}            % math medium sizes
\usepackage{amsfonts}           % math fonts
\usepackage{amssymb}            % math symb
\usepackage[a4paper, left=2cm, right=2cm, top=2cm,
        bottom=3cm]{geometry}   % pagesize

\usepackage{color}
\usepackage{xcolor}
\definecolor{light-gray}{gray}{0.9}

\usepackage{titlesec}
\usepackage{float}
\usepackage{multirow}
\usepackage{tabularx}
\usepackage{placeins}
\usepackage{totcount}
\usepackage[hidelinks,pdftex]{hyperref}
\usepackage[numbers,sort&compress]{natbib}
\usepackage{caption}
\usepackage{subcaption}
\frenchspacing
\setcounter{page}{1}
\bibliographystyle{utf8gost705u}
\makeatletter % [1] -> 1.
\renewcommand\@biblabel[1]{#1.}
\makeatother
\addto\captionsrussian{\def\refname{Библиографический список}}
\regtotcounter{page}
\regtotcounter{figure}
\regtotcounter{table}
\captionsetup{justification=centering,labelsep=period}
\captionsetup[table]{aboveskip=0pt,belowskip=0pt}

\usepackage{soul}               % \so{} & \ul{} - source and underline
\usepackage{soulutf8}           % UTF-8 for soul
\usepackage{verbatim}           % \verb{} and verbatim environment
\usepackage{listings}           % source code `bl
\lstset{
   escapeinside={\#@}{@},
        extendedchars=\true,
        numbers=left,
        inputencoding=utf8,
        keepspaces=true,
        basicstyle=\footnotesize\ttfamily,
        backgroundcolor=\color{light-gray},
        tabsize=3,
        breaklines=true,
        postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}}
     }

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}                      % clear header and footer
\fancyfoot[C]{\thepage}         % page number
\renewcommand{\headrulewidth}{0pt}      % remove that line

\linespread{1.4}                % line interval ~1.5
\renewcommand{\rmdefault}{ftm}

\newcommand\header[3]{          % `H {sub}{*}{TITLE}
   \def \a {#1}
   \def \b {sub}
   \ifx\a\b
   \subsection#2{#3}
   \else
   \section#2{#3}
   \fi
   \ifx x#2x
   \else
   \addcontentsline{toc}{#1section}{#3}
   \fi
}

% ------------------------------
% Table of contents

\setcounter{secnumdepth}{4}
\usepackage{mathtext}
\renewcommand*{\familydefault}{\sfdefault} % clear font defaults
\usepackage{microtype}
\sloppy

% ------------------------------
% Page geometry & text spacing

\usepackage{parskip}
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}

%% \usepackage{atbegshi} % http://ctan.org/pkg/atbegshi
%% \AtBeginDocument{\AtBeginShipoutNext{\AtBeginShipoutDiscard}}

\let\OLDitemize\itemize % itemize spacing
\renewcommand\itemize{\OLDitemize\addtolength{\itemsep}{-5pt}}

   \renewcommand{\arraystretch}{1.5}

   % ------------------------------
   % Code listings

\definecolor{mGreen}{rgb}{0,0.6,0}
\definecolor{mGray}{rgb}{0.5,0.5,0.5}
\definecolor{mPurple}{rgb}{0.58,0,0.82}
\definecolor{backgroundColour}{rgb}{0.95,0.96,0.97}


% C language codestyle
\lstdefinestyle{CStyle}{
   backgroundcolor=\color{backgroundColour},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mPurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    postbreak=\%\space,
    %belowskip=-1,
    language=C
 }

 % sh language codestyle
\lstdefinestyle{shStyle} {
   backgroundcolor=\color{backgroundColour},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mPurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    postbreak=\%\space,
    morecomment=[s][\color{red}]{\ -}{\ },
    otherkeywords={$,@,>,<,\#,!,ELIF,IF,THEN,ELSE,FI,ESAC,CASE,WHILE,DO,UNTIL,FOR,echo,man,chmod},
    language=sh
 }
 %$$

 % listings titles style
\newenvironment{funci}[1]{{{\textbf{#1}}}}{}

% for C language code
\lstnewenvironment{CCode}[1]{
   \lstset{style=cStyle}
   \funci{#1}~}{
}

% for sh code
\lstnewenvironment{shCode}[1]{
   \lstset{style=shStyle}
   \funci{#1}~}{
}

% ------------------------------
% Special commands an environments


% for spaced environvent (example^ prompt string section)
\newenvironment{myenv}[2]{
   \renewcommand{\tabcolsep}{0cm}
   \begin{tabular}{p{0.15\linewidth}p{0.85\linewidth}}
      \textbf{#1} & #2
   \end{tabular}\\[0.5em]
   }{
      }

\usepackage{xpatch}
\makeatletter
\xpatchcmd{\@thm}{\thm@headpunct{.}}{\thm@headpunct{ --- \\}}{}{}
\makeatother

% for definitions
\newenvironment{defi}[1]{
   \textbf{#1} ---
      \\[0.3em]
      \begin{tabular}{p{0.5\linewidth}p{0.9\linewidth}}
         & 
         }
         {
      \end{tabular}
      }

      % for important addings	
\newenvironment{important}{\textbf{Важно: }{}}

\newenvironment{boxy}{
   \renewcommand{\arraystretch}{1.8}
   \begin{tabular}{|p{1\linewidth}|}
      \hline
      }
      {
         \\ \hline
   \end{tabular}
   }

\begin{document}

\cleardoublepage\clearpage


\input{titlepage.tex}

\clearpage

\tableofcontents

\clearpage 
\addcontentsline{toc}{chapter}{Благодарности}
\chapter*{Благодарности}
\input{acknowledgements.tex}

% ------------------------------
% Часть: Основы системного программирования

\clearpage \part{Системное программное обеспечение}
%\input{./shell/content.tex}

   \chapter{Операционная система}

      \section{Роль операционной системы}
      \input{./general/UNIX-OS/OS-benefits/content.tex}

      \section{Типовая ОС UNIX}
      \input{./general/UNIX-OS/UNIX-structure/content.tex}

      \section{Ядро типовой ОС UNIX}
      \input{./general/UNIX-OS/UNIX-kernel/content.tex}

         \subsection{Подсистемы ядра}
         \input{./general/UNIX-OS/UNIX-kernel/os-subsystems/content.tex}

         \subsection{Исключения, прерывания, системные вызовы}

            \subsubsection{Исключения}
            \input{./general/UNIX-OS/UNIX-kernel/interrupts-exceptions-syscalls/exceptions/content.tex}

            \subsubsection{Прерывания}
            \input{./general/UNIX-OS/UNIX-kernel/interrupts-exceptions-syscalls/interrupts/content.tex}

            \subsubsection{Системные вызовы.}
            \input{./general/UNIX-OS/UNIX-kernel/interrupts-exceptions-syscalls/syscalls/content.tex}


   \chapter{Концепция системного программирования}
   \input{./general/SP/content.tex}

      \section{Языки системного программирования}
      \input{./general/SP/SP-languages/content.tex}

      \section{Системные вызовы}
      \input{./general/SP/system-calls/content.tex}

      \section{Ввод-вывод}

      \section{Процессы и потоки}

   \chapter{Работа в ОС UNIX}

      \section{Терминал}
      \input{./general/work-in-UNIX/terminal/content.tex}

         \subsection{Канонический и неканонический режимы ввода}
         \input{./general/work-in-UNIX/terminal/input-modes/content.tex}

      \section{Командный интерпретатор}
      \input{./general/work-in-UNIX/command-interpreter/content.tex}

      \section{Программа, утилита, команда}
      \input{./general/work-in-UNIX/programm-utility-command/content.tex}


      % ------------------------------
      % Часть: Командный интерпретарор shell

\clearpage \part{Командный интерпретатор shell}
%\input{./shell/content.tex}

   \chapter{Основные понятия}

      \section{Командный интерпретатор}
      \input{./shell/shell-basics/command-interpreter/content.tex}

         \subsection{Приглашения командной строки (prompt string)}
         \input{./shell/shell-basics/command-interpreter/prompt-strings/content.tex}			

      \section{Принципы исполнения инструкций}

         \subsection{IFS}
         \input{./shell/shell-basics/instructions/IFS/content.tex}

         \subsection{Группировка команд и запуск команд в subshell}
         \input{./shell/shell-basics/instructions/group-and-subshell/content.tex}

         \subsection{Разделители команд}
         \input{./shell/shell-basics/instructions/command-separators/content.tex}

         \subsection{Glob-джокеры}
         \input{./shell/shell-basics/instructions/glob-jokers/content.tex}

         \subsection{Переменные}
         \input{./shell/shell-basics/shell-variables/content.tex}

            \subsubsection{Обрезка переменных}
            \input{./shell/shell-basics/shell-variables/sharp-percent/content.tex}

         \subsection{Как shell интерпретирует команду}
         \input{./shell/shell-basics/instructions/interpretation/content.tex}

   \chapter{Скрипты shell}
   \input{./shell/scripts/content.tex}

      \section{Именование и запуск скриптов}
      \input{./shell/scripts/naming-and-executing/content.tex}

      \section{Позиционные параметры}
      \input{./shell/scripts/pos-params/content.tex}

      \section{Специальные переменные}
      \input{./shell/scripts/special-params/content.tex}

   \chapter{Встроенные возможности и конструкции shell}
   \input{./shell/shell-benefits/content.tex}

      \section{Математические операции}
      \input{./shell/shell-benefits/shell-math-and-comp/shell-math/content.tex}

      \section{Условные кострукции, циклы, функции, комментарии}

         \subsection{Условные кострукции}
         \input{./shell/shell-benefits/shell-if-case-cycles-funcs-comments/shell-if-case/content.tex}

         \subsection{Циклы}
         \input{./shell/shell-benefits/shell-if-case-cycles-funcs-comments/shell-cycles/content.tex}

         \subsection{Функции}
         \input{./shell/shell-benefits/shell-if-case-cycles-funcs-comments/shell-funcs/content.tex}

         \subsection{Комментарии}
         \input{./shell/shell-benefits/shell-if-case-cycles-funcs-comments/shell-comments/content.tex}

      \chapter{Потоки ввода-вывода}
      \input{./shell/io-streams/content.tex}

         \section{Стандартные потоки ввода-вывода}
         \input{./shell/io-streams/std-io-streams/content.tex}

         \section{Перенаправление потоков}
         \input{./shell/io-streams/streams-redirection/content.tex}

      \chapter{set и env}

         \section{Команда set}
         \input{./shell/set-env/set/content.tex}

         \section{Утилита env}
         \input{./shell/set-env/env/content.tex}



         % ------------------------------
         % Часть: Язык Си в системном программировании

\clearpage \part{Язык Си в системном программировании}
\input{./C-language-in-system-programming/content.tex}

   \chapter{Программы на языке Си}
   \input{./C-language-in-system-programming/C-programms/content.tex}

      \section{Заголовочные файлы}
      \input{./C-language-in-system-programming/C-programms/C-headers/content.tex}

         \subsection{Часто используемые заголовочные файлы UNIX}
         \input{./C-language-in-system-programming/C-programms/C-headers/UNIX-common-headers/content.tex}

      \section{main-функция}
      \input{./C-language-in-system-programming/C-programms/main-function/content.tex}

         \subsection{Аргументы main-функции}
         \input{./C-language-in-system-programming/C-programms/main-function/main-args/content.tex}

      \section{Код возврата}
      \input{./C-language-in-system-programming/C-programms/exit-code/content.tex}

      \section{Ошибки и стандартизация ошибок}
      \input{./C-language-in-system-programming/C-programms/errno/content.tex}

         \subsection{perror (3) и strerror (3)}
         \input{./C-language-in-system-programming/C-programms/errno/perror-strerror/content.tex}

   \chapter{Компиляция программы}
   \input{./C-language-in-system-programming/compilation/content.tex}

      \section{Компиляторы}
      \input{./C-language-in-system-programming/compilation/compilers/content.tex}

      \section{Makefile и утилита make}
      \input{./C-language-in-system-programming/compilation/Makefile-make/content.tex}


      % ------------------------------
      % Часть: Файлы и файловая система

\clearpage \part{Файлы и файловая подсистема}

   \chapter{Все есть файл! (Кроме потоков и ядра)}
   \input{./files-fs/everything-file/content.tex}

      \section{inode}
      \input{./files-fs/everything-file/inode/content.tex}

         \section{Структура stat}
         \input{./files-fs/everything-file/inode/stat-struc/content.tex}

      \section{Файловый дескриптор}
      \input{./files-fs/everything-file/filedes/content.tex}

         \subsection{Работа с файловым дескриптором}
         \input{./files-fs/everything-file/filedes/filedes-actions/content.tex}

         \subsection{fcntl}
         \input{./files-fs/everything-file/filedes/fcntl/content.tex}

      \section{Типы файлов}
      \input{./files-fs/everything-file/file-types/content.tex}

   \chapter{Файловый ввод-вывод}

      \section{Открытие и закрытие файла}
      \input{./files-fs/files/open-close/content.tex}

      \section{Перемещение внутри файла}
      \input{./files-fs/files/lseek/content.tex}

      \section{Ввод-вывод}

         \subsection{Простой ввод-вывод}
         \input{./files-fs/files/io/basic-io/content.tex}

         \subsection{Ввод-вывод со смещением}
         \input{./files-fs/files/io/offset-io/content.tex}

         \subsection{Векторный ввод-вывод}
         \input{./files-fs/files/io/diffuse-io/content.tex}

      \subsection{Конец файла}
      \input{./files-fs/files/end-of-file/content.tex}

   \chapter{Директории}
   \input{./files-fs/directories/content.tex}	

      \section{Структура dirent}
      \input{./files-fs/directories/dirent-struc/content.tex}

      \section{Получение текущей рабочей директории и ее изменение}
      \input{./files-fs/directories/cd/content.tex}	

      \section{Создание и удаление директорий}
      \input{./files-fs/directories/mkdir-rmdir/content.tex}	


   \chapter{Ссылки}

      \section{Жесткие ссылки}
      \input{./files-fs/links/ln/content.tex}

      \section{Символьные ссылки}
      \input{./files-fs/links/ln-s/content.tex}

   \chapter{Файлы устройств}
   \input{./files-fs/dev-files/content.tex}



   % ------------------------------
   % Часть: Пользователи и группы

\clearpage \part{Пользователи и группы}

   \chapter{Пользователи и группы}
   \input{./users-and-groups/users-groups/content.tex}

      \section{Атрибуты пользователя}
      \input{./users-and-groups/users-groups/passwd/content.tex}

         \subsection{Атрибуты группы}
         \input{./users-and-groups/users-groups/group/content.tex}

         \subsection{Утилита getent}
         \input{./users-and-groups/users-groups/getent/content.tex}



         % ------------------------------
         % Часть: Права и владельцы

\clearpage \part{Владельцы файлов, права и режимы доступа}

   \chapter{Права и режимы доступа}
   \input{./modes-owners/modes/content.tex}

      \section{Права доступа}

         \subsection{Проверка прав доступа}
         \input{./modes-owners/modes/access-rules/access-check/content.tex}

         \subsection{Изменение прав доступа}
         \input{./modes-owners/modes/access-rules/chmod/content.tex}

         \subsection{Маска создания файла}
         \input{./modes-owners/modes/access-rules/umask/content.tex}


   \chapter{Владельцы файлов}

      \section{Изменение владельца файла}
      \input{./modes-owners/owners/chown/content.tex}


      % ------------------------------
      % Часть: Память

\clearpage \part{Память}

   \chapter{Как устроена память}
   \input{./memory/memory-model/content.tex}

      \section{Аллокация памяти}
      \input{./memory/memory-model/memory-allocation/content.tex}

      % ------------------------------
      % Часть: Процессы и потоки

\clearpage \part{Процессы и потоки}

   \chapter{Процессы}
   \input{./processes-and-threads/processes/content.tex}

      \section{Атрибуты процесса}
      \input{./processes-and-threads/processes/attributes/content.tex}

      \section{Жизненный цикл процесса}
      \input{./processes-and-threads/processes/lifecycle/content.tex}

      \section{Создание процессов}

         \subsection{Семейство системных вызовов fork}
         \input{./processes-and-threads/processes/work-with/fork/content.tex}

         \subsection{Семейство системных вызовов exec}
         \input{./processes-and-threads/processes/work-with/exec/content.tex}

   \chapter{Межпроцессное взаимодействие}
   \input{./processes-and-threads/processes-interconnection/content.tex}	

      \section{Семафоры}
      \input{./processes-and-threads/processes-interconnection/semaphores/content.tex}

      \section{Каналы}

         \subsection{Неименованные каналы}
         \input{./processes-and-threads/processes-interconnection/pipes/unnamed/content.tex}

         \subsection{Именованные каналы}
         \input{./processes-and-threads/processes-interconnection/pipes/named/content.tex}	

      \section{Сокеты}
      \input{./processes-and-threads/processes-interconnection/sockets/content.tex}

      \section{Сигналы}
      \input{./processes-and-threads/processes-interconnection/signals/content.tex}

         \subsection{Обработка сигналов}
         \input{./processes-and-threads/processes-interconnection/signals/sigaction/content.tex}	

      \section{Очереди сообщений}
      \input{./processes-and-threads/processes-interconnection/messages-queues/content.tex}	

      \section{Разделяемая память}

      \section{Механизм STREAMS}
      \input{./processes-and-threads/processes-interconnection/STREAMS/content.tex}	

   \chapter{Потоки}
   \input{./processes-and-threads/threads/content.tex}

      \section{Легковесные процессы}
      \input{./processes-and-threads/threads/lightweight-proc/content.tex}

      \section{Межпоточное взаимодействие}
      \input{./processes-and-threads/threads/threads-interconnection/content.tex}	

         \subsection{Общее адресное пространство}

         \subsection{Переменные volatile}
         \input{./processes-and-threads/threads/threads-interconnection/volatile/content.tex}		

         \subsection{Мьютексы}
         \input{./processes-and-threads/threads/threads-interconnection/mutexes/content.tex}	

         \subsection{rwlock}
         \input{./processes-and-threads/threads/threads-interconnection/rwlock/content.tex}	


\clearpage
\addcontentsline{toc}{chapter}{Литература}
\input{./resources.tex}

\end{document}
